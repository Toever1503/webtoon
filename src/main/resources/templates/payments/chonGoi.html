<!DOCTYPE>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout.html}">

<head>
  <title>Chọn gói phù hợp</title>
  <script src="https://kit.fontawesome.com/b86979ecfa.js" crossorigin="anonymous"></script>
  <script src="node_modules/@material-tailwind/html/scripts/collapse.js"></script>
  <link href="../../static/main.css" rel="stylesheet" />

</head>

<body>
  <div class="w-[1100px] m-auto bg-white min-h-[800px] p-[15px]" layout:fragment="content">


    <!--    begin check show notification-->
    <div th:if="${showNotification != null}" id="notification_subscription" th:data-message="${notificationMessage}">
      <script>
        window.addEventListener("DOMContentLoaded", (event) => {
          window.Toast.show('success', document.getElementById('notification_subscription').dataset.message, 1000)
        });
      </script>
    </div>
    <!--    end check show notification-->

    <div class="breadcrumb py-[10px]">
      <nav class="w-full rounded-md">
        <ol class="list-reset flex">
          <li><a href="/"
              class="text-sm text-blue-400 transition duration-150 ease-in-out hover:text-blue-600 focus:text-blue-600 active:text-blue-700 dark:text-blue-400 dark:hover:text-blue-500 dark:focus:text-blue-500 dark:active:text-blue-600">Trang
              chủ</a>
          </li>
          <li><span class="mx-2 text-neutral-500 dark:text-neutral-400">/</span>
          </li>
          <li><a
              class="text-sm text-primary transition duration-150 ease-in-out text-neutral-500 dark:text-neutral-400">
              Danh sách gói đọc
            </a>
        </ol>
      </nav>
    </div>

    <div class="flex justify-center py-4 md:py-8 flex-wrap">
      <div class="max-w-full mt-10">
        <ul>
          <li class="text-xl font-bold ">
            Chọn gói dịch vụ phù hợp với bạn
          </li>
          <li class="text-sm ">
            <i class="fa-solid fa-check"></i> Truy cập và đọc tất cả truyện
            trên trang web.
          </li>
          <li class="text-sm ">
            <i class="fa-solid fa-check"></i> Được sử dụng tất cả các tính năng.
          </li>
          <li class="text-sm ">
            <i class="fa-solid fa-check"></i> Được hỗ trợ xử lý nhanh các sự cố khi gặp phải.
          </li>
        </ul>
      </div>

      <p th:if="${hasConfirmingOrder}" class="text-center mt-[15px] bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-4">
        Bạn có đơn hàng đang chờ admin xác nhận. Vui lòng đợi admin xác nhận xong để có thể mua thêm. <br/>
        <span>Bấm vào <a href="/user/order-history?status=USER_CONFIRMED_BANKING&search=" class="text-blue-400 hover:text-blue-500">đây</a> để xem chi tiết.</span>
      </p>
    </div>

    <!-- begin subscription list -->

    <script>
      function showPaymentModal(e) {
        document.getElementById('payment_modal').classList.remove('hidden');
        document.getElementById('subscriptionPack').value = e.dataset.id;
        document.getElementById('subscriptionPackName').innerHTML = e.dataset.name;
        document.getElementById('subscriptionPackPrice').innerHTML = e.dataset.price + ' vnd';
      }


    </script>

    <div class="subscription-list mt-[50px]">


      <ul class="flex flex-wrap gap-[10px] justify-center">

        <!-- begin free trial -->
        <li
          th:if="${session.loggedUser == null || (session.loggedUser.getCurrentUsedSubsId() == null && !hasExpiredTrial)}"
          class="border rounded w-[250px] min-h-[300px] bg-[#f2f2f2] px-[15px] py-[25px] text-[#303233] text-center relative">

          <p th:if="${isUsingTrial == true}"
            class="text-center bg-[#eb3349] py-[10px] font-semibold text-white absolute top-[-44px] left-0 w-full">Gói
            hiện tại</p>
          <h3 class="text-base font-semibold">Gói dùng thử 3 ngày</h3>

          <p class="text-2xl pt-[20px]">
            <span>0 đ</span>

            <br>
          <div class="min-h-[50px]">

          </div>
          </p>

          <p>
            Được đọc miễn phí tất cả truyện trong 3 ngày
          </p>

          <div class="flex justify-center"
            th:if="${session.loggedUser == null || session.loggedUser.getTrialRegisteredDate() == null}">

            <a th:if="${session.loggedUser != null && session.loggedUser.role.roleName.name() == 'CUS'}" href="/order/register-trial"
              class="mt-[20px] bg-red-500 hover:bg-red-600 text-white text-xl py-[10px] px-[20px] rounded">Đăng
              ký ngay</a>

            <a th:if="${session.loggedUser == null}" href="/signin?redirectTo=/subscription_pack/load"
              class="mt-[20px] bg-red-500 hover:bg-red-600 text-white text-xl py-[10px] px-[20px] rounded">Đăng
              ký ngay</a>
          </div>

        </li>
        <!-- end free trial -->

        <li
          class="border rounded w-[250px] min-h-[300px] bg-[#f2f2f2] px-[15px] py-[25px] text-[#303233] text-center relative"
          th:each="item : ${items}">

          <p th:if="${session.loggedUser != null && session.loggedUser.currentUsedSubsId == item.id && !isExpiredSub}"
            class="text-center bg-red-500 py-[10px] font-semibold text-white absolute top-[-44px] left-0 w-full">Gói
            hiện tại</p>

          <h3 class="text-base font-semibold" th:text="${item.monthCount + ' tháng'}"></h3>

          <p class="text-2xl pt-[20px]">
            <span th:text="${#numbers.formatDecimal(item.price, 0, 'POINT', 0, 'POINT') + 'đ'}">10.00</span>

            <br>
          <div class="min-h-[50px] pt-[10px]">
            <p th:if="${item.description != null && item.description.length() > 0}" th:text="${item.description}"
              class="text-[15px] text-[#de3723] font-semibold">
            </p>
          </div>
          </p>

          <p th:text="${'Được đọc tất cả truyện trong '+ item.monthCount +' tháng.'}"></p>


          <div class="flex justify-center">

            <span th:if="${session.loggedUser != null && session.loggedUser.role.roleName.name() == 'CUS' && !hasConfirmingOrder}" th:data-id="${item.id}" th:data-name="${item.name}"
              th:data-price="${#numbers.formatDecimal(item.price, 0, 'POINT', 0, 'POINT') }"
              th:onclick="showPaymentModal(this)"
              class="mt-[20px] bg-red-500 hover:bg-red-600 text-white text-xl py-[10px] px-[20px] rounded cursor-pointer">

              <span th:text="${session.loggedUser.canReadUntilDate.after(#dates.createNow()) ? 'Mua thêm': 'Chọn'}">Chọn</span>
            </span>

            <a th:if="${session.loggedUser == null}" href="/signin?redirectTo=/subscription_pack/load"
              class="mt-[20px] bg-red-500 hover:bg-red-600 text-white text-xl py-[10px] px-[20px] rounded cursor-pointer">
              Chọn
            </a>
          </div>
        </li>

      </ul>

      <p class="text-[12px] text-center mt-[10px]">Lưu ý: Giá trên đã bao gồm VAT</p>
    </div>

    <!-- end subscription list -->


    <!-- begin choose payment method -->
    <div class="relative z-10 hidden" id="payment_modal" aria-labelledby="modal-title" role="dialog" aria-modal="true">
      <!--
        Background backdrop, show/hide based on modal state.
    
        Entering: "ease-out duration-300"
          From: "opacity-0"
          To: "opacity-100"
        Leaving: "ease-in duration-200"
          From: "opacity-100"
          To: "opacity-0"
      -->
      <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>

      <div class="fixed inset-0 z-10 overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
          <!--
            Modal panel, show/hide based on modal state.
    
            Entering: "ease-out duration-300"
              From: "opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
              To: "opacity-100 translate-y-0 sm:scale-100"
            Leaving: "ease-in duration-200"
              From: "opacity-100 translate-y-0 sm:scale-100"
              To: "opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
          -->
          <div
            class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg">

            <form id="payment_form" action="/order/create-order">
              <div class="bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4">
                <div class="sm:flex sm:items-start">
                  <div class="mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left">
                    <div>
                      <label for="subscriptionPack" class="text-base font-semibold leading-6 text-gray-900 mb-2">Thông
                        tin gói</label>
                      <div>
                        <p class="text-sm text-gray-500" id="subscriptionPackName">Gói 3 tháng</p>
                        <p class="text-sm text-gray-500" id="subscriptionPackPrice">Giá: 19990đ</p>
                      </div>

                      <input class="hidden" id="subscriptionPack" name="subscriptionPack" value="">
                    </div>

                    <div class="mt-[10px]">
                      <label for="paymentMethod" class="text-base font-semibold leading-6 text-gray-900 mb-2"
                        id="modal-title">Vui lòng chọn
                        hình
                        thức
                        thanh toán</label>

                      <select id="paymentMethod" name="paymentMethod" class="border px-[5px] text-sm text-gray-500">
                        <option value="VN_PAY">Thanh toán qua VNPAY</option>
                        <option value="ATM">Thanh toán chuyển khoản</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
                <button type="submit"
                  class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto">Tiếp
                  tục</button>
                <button type="button" id="close_payment_modal"
                  class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto">Hủy</button>

                <script>
                  document.addEventListener("DOMContentLoaded", function () {
                    document.getElementById("close_payment_modal").addEventListener("click", function () {
                      document.getElementById("paymentMethod").value = 'VN_PAY';
                      document.getElementById("payment_modal").classList.add("hidden");
                      document.getElementById("payment_form").action = '/payment/pay';
                    });

                  });
                </script>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- end choose payment method -->
  </div>
</body>

</html>