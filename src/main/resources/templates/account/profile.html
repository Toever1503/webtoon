<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">

<head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Thông tin cá nhân</title>
  <link href="/src/main/resources/static/main.css" rel="stylesheet"/>
  <script src="https://kit.fontawesome.com/b86979ecfa.js" crossorigin="anonymous"></script>
  <script src="node_modules/@material-tailwind/html/scripts/collapse.js"></script>
</head>

<body>
<div class="w-[1100px] mx-auto bg-white" layout:fragment="content">
  <div class="grid grid-cols-4 min-h-[670px]">
    <div th:replace="account/fragments/sidebar :: user-sidebar"/>

    <div class="col-span-3">
      <div>
        <div class="mx-auto w-[780px] h-[480px] p-[15px] mt-4 bg-white">
          <p class="text-2xl font-medium">Thông tin cá nhân</p>

          <div class="change_avatar p-[10px] flex items-center">
            <div class="w-[100px] h-[100px] rounded-full border border-gray-200 mx-auto block">
              <img loading="lazy"
                   th:src="${session.loggedUser.avatar != null ? session.loggedUser.avatar : '/static/icons/avatar-icon.png'}"
                   alt="avatar"
                   class="w-full h-full rounded-full">
            </div>

            <div>
              <h3>Ảnh đại diện</h3>
              <p>Chỉ cho phép ảnh PNG hoặc JPG kích thước dưới 500px.</p>
            </div>

            <form id="update_avatar_form" class="hidden" action="/user/update-avatar" method="post"
                  enctype="multipart/form-data">
              <input id="user_avatar" name="avatar" type="file" accept="image/png,image/jpg,image/jpeg">
            </form>

            <button
                    id="choose_avatar_btn"
                    class="bordered border-[1px] border-[#159f46] hover:bg-[#159f46] text-[#159f46] hover:text-white duration-300 ease-in-out p-[5px] rounded mx-auto mt-[10px] block">
              Chọn ảnh
            </button>

            <script>
                 document.addEventListener('DOMContentLoaded', function () {
                      document.getElementById('user_avatar').addEventListener('change', function (e) {
                          console.log(e.target.files[0]);
                          const file = e.target.files[0];
                          if(file.size > 500000) {
                              alert('Ảnh quá lớn, vui lòng chọn ảnh khác');
                              return;
                          }
                          if(file.type !== 'image/png' && file.type !== 'image/jpg' && file.type !== 'image/jpeg') {
                              alert('Ảnh không đúng định dạng, vui lòng chọn ảnh khác');
                              return;
                          }
                           document.getElementById('update_avatar_form').submit();
                      });

                      document.getElementById('choose_avatar_btn').addEventListener('click', function () {
                         document.getElementById('user_avatar').click();
                      });
                 });



            </script>
          </div>

          <div class="mt-[15px]">
            <form th:action="@{/user/profile}" th:object="${user}" method="POST">
              <div class="grid grid-cols-2 gap-x-4">
                <div>
                  <div class="">
                    <span class="font-semibold text-slate-700 pb-2">Họ và tên</span>
                  </div>
                  <input th:value="${user.fullName}" th:field="*{fullName}"
                         class="mt-3 appearance-none border-2 border-gray-200 rounded w-4/5 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-red-300"
                         id="inline-full-name" type="text">
                </div>
                <div>
                  <div class="">
                    <span class="font-semibold text-slate-700 pb-2">Email</span>
                  </div>

                  <input th:value="${user.email}" th:field="*{email}"
                         class="mt-3 appearance-none border-2 border-gray-200 rounded w-4/5 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white"
                         id="inline-full-name" type="text">
                </div>

                <div>
                  <div class="mt-5">
                    <span class="font-semibold text-slate-700 pb-2">Giới tính</span>
                  </div>

                  <div class="flex mt-2">
                    <div class="flex items-center mr-4">
                      <input id="inline-radio" type="radio" th:field="*{sex}" th:value="'MALE'"
                              th:checked="${user.sex == 'MALE'}" name="inline-radio-group"
                             class="w-4 h-4 text-blue-600 bg-blue-400 border-red-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-blue-800 focus:ring-2 ">
                      <label for="inline-radio" class="ml-2 text-sm font-medium text-gray-900 ">Nam</label>
                    </div>
                    <div class="flex items-center mr-4">
                      <input id="inline-2-radio" type="radio" th:field="*{sex}" th:value="'FEMALE'"
                             name="inline-radio-group"
                             class="w-4 h-4 text-blue-600 bg-blue-400 border-red-300 focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-blue-800 focus:ring-2">
                      <label for="inline-2-radio" class="ml-2 text-sm font-medium text-gray-900">Nữ</label>
                    </div>
                  </div>
                </div>

                <div>
                  <div class="mt-5">
                    <span class="font-semibold text-slate-700 pb-2normal">Số điện thoại</span>
                  </div>
                  <input th:value="${user.phone}" th:field="*{phone}"
                         class="mt-3 appearance-none border-2 border-gray-200 rounded w-4/5 py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white"
                         id="inline-full-name" type="text">


                </div>

              </div>

              <p class="text-[13px] text-red-500 px-[5px]" th:if="${error != null}" th:text="${error}"></p>
              <p class="text-[13px] text-green-500 px-[5px]" th:if="${success != null}" th:text="${success}"></p>

              <div class="flex justify-start mt-10">
                <input type="submit"
                       class="inline-flex w-full justify-center rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 sm:ml-3 sm:w-auto cursor-pointer"
                       value="Cập nhật"/>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script th:if="${notifySuccessMessage != null}" th:inline="javascript">

        window.addEventListener("DOMContentLoaded", (event) => {
            setTimeout(() => {
            window.Toast.success(/*[[${notifySuccessMessage}]]*/);
            }, 300);
        });


  </script>
</div>
</body>

</html>