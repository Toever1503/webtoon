<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout.html}">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Document</title>
    <link href="../static/main.css" rel="stylesheet"/>
</head>

<body>
<div class="max-w-[1100px] mx-auto p-[15px]" layout:fragment="content">
    <div class="breadcrumb py-[10px]">
        <nav class="w-full rounded-md">
            <ol class="list-reset flex">
                <li><a href="/"
                       class="text-sm text-blue-400 transition duration-150 ease-in-out hover:text-blue-600 focus:text-blue-600 active:text-blue-700 dark:text-blue-400 dark:hover:text-blue-500 dark:focus:text-blue-500 dark:active:text-blue-600">Trang
                    chủ</a>
                </li>
                <li><span class="mx-2 text-neutral-500 dark:text-neutral-400">/</span>
                </li>
                <li><a
                       class="text-sm text-primary transition duration-150 ease-in-out text-neutral-500 dark:text-neutral-400">Danh sách truyện</a>
                </li>
            </ol>
        </nav>
    </div>

    <div class="flex justify-between">
        <div class=" w-3/4 p-4">
            <div class="flex justify-center">
                <div class="w-full">
                    <h2 th:if="${mangalist == null}">Không có dữ liệu!</h2>
                    <div th:else class="grid grid-cols-4 gap-4">
                        <div class="flex justify-center " th:each="mangalist : ${mangalist}">
                            <div class="w-full flex flex-col">
                                <div class="">
                                    <img class="w-56 h-56" th:src="${mangalist.featuredImage}" alt="">
                                </div>
                                <div class="flex justify-center">
                                    <div class="w-full flex flex-col">
                                        <div class="my-1">
                                            <p class="text-xl text-black" th:text="${mangalist.mangaName}"></p>
                                        </div>
                                        <div class="flex flex-row">
                                            <div class="mr-2 mb-1">
                                                <ul class="flex p-1">
                                                    <li class="scale-100  ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                             fill="currentColor" class="bi bi-star-fill fill-yellow-400"
                                                             viewBox="0 0 16 16">
                                                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                        </svg>
                                                    </li>
                                                    <li class="scale-100 ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                             fill="currentColor"
                                                             class="bi bi-star-fill  fill-yellow-400"
                                                             viewBox="0 0 16 16">
                                                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                        </svg>
                                                    </li>
                                                    <li class="scale-100 ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                             fill="currentColor"
                                                             class="bi bi-star-fill  fill-yellow-400"
                                                             viewBox="0 0 16 16">
                                                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                        </svg>
                                                    </li>
                                                    <li class="scale-100 ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                             fill="currentColor"
                                                             class="bi bi-star-fill  fill-yellow-400"
                                                             viewBox="0 0 16 16">
                                                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                        </svg>
                                                    </li>
                                                    <li class="scale-100 ">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                             fill="currentColor"
                                                             class="bi bi-star-fill  fill-yellow-400"
                                                             viewBox="0 0 16 16">
                                                            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                                                        </svg>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div>
                                                <h1 th:text="${mangalist.rating}"></h1>
                                            </div>
                                        </div>
                                        <div class=" mb-1">
                                            <!-- <div class="flex flex-row mb-1">
                                              <div class="mr-2">
                                                <button class="rounded-full bg-slate-200 text-sm text-slate-400">Chapter 1</button>
                                              </div>
                                              <div>
                                                <h2 class="text-base">volume 1</h2>
                                              </div>
                                            </div>
                                            <div>
                                              <p class="text-sm text-slate-400">October 11, 2017</p>
                                            </div> -->
                                            <!--  for display chapter by vol-->

                                            <ul th:if="${mangalist.volumeEntities.size() > 0 && volI.index < 1}"
                                                class="latest-chapters grid mt-[10px] gap-[5px]"
                                                th:each="volume,volI : ${mangalist.volumeEntities}">
                                                <li th:each="chapter,iter: ${volume.chapterEntities}"
                                                    th:if="${iter.index < 2}">

                                                    <div class="gap-[5px] flex items-center">
                                                        <a th:href="@{'/manga/'+${mangalist.mangaName}+'/chapter/'+${chapter.id}}"
                                                           th:text="${'Chương ' + (chapter.chapterIndex + 1)}"
                                                           class="block min-w-[80px] max-w-[120px] py-[2px] h-full text-center text-[12px] text-[#666666] hover:text-white bg-[#ebebeb] hover:bg-[#eb3349] duration-300 ease-in rounded-[10px]">
                                                        </a>
                                                        <span class="text-[12px] text-[#666666]"
                                                              th:text="${'Tập ' + (volume.volumeIndex + 1)}">
                                  </span>
                                                    </div>

                                                    <!--                                        <p class="text-[12px] text-[#666666] text-center" th:text="${volume.createdAt}"></p>-->
                                                </li>
                                            </ul>
                                            <!--  for display chapter by chap -->
                                            <ul th:else class="latest-chapters grid mt-[10px] gap-[5px]">
                                                <li class="gap-[5px] flex" th:each="chapter,iter: ${mangalist.chapters}"
                                                    th:if="${iter.index < 2}"
                                                >
                                                    <a th:href="@{'/manga/'+${mangalist.mangaName}+'/chapter/'+${chapter.id}}"
                                                       th:text="${'Chương ' + (chapter.chapterIndex + 1)}"
                                                       class="block min-w-[80px] max-w-[120px] py-[2px] h-full text-center text-[12px] text-[#666666] hover:text-white bg-[#ebebeb] hover:bg-[#eb3349] duration-300 ease-in rounded-[10px]">
                                                    </a>
                                                    <!--                                        <span class="text-[12px] text-[#666666]" th:text="${chapter.createdAt}">-->
                                                    <!--                                        </span>-->
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div th:if="${!mangalist.isEmpty()}" th:replace="fragments/page-component :: page-component" />
                </div>
            </div>
        </div>
        <div class=" w-1/4 p-2">
            <!-- phần tử con bên phải -->
            <div class="flex justify-center">
                <div class="w-full p-2 ">
                    <div class="flex flex-col">
                        <div class="sidebar-section py-[10px] border px-[15px]" style="border: 1px solid #9e9e9e2e;">
                            <h3 class="sidebar-section_title text-xl font-bold bordered border-b-[2px] border-black pb-2 m-0 mb-[15px]">
                                Lịch sử đọc truyện
                            </h3>

                            <div id="card-list" class="card-container manga-history-sidebar grid space-y-2">
                            </div>
                            <!--sự kiện đọc lịch sử từ localstorage-->

                            <script th:inline="javascript">
                                    /*<![CDATA[*/
                                    document.addEventListener('DOMContentLoaded',function () {

                                        const logger = /*[[${logger}]]*/ 'default';
                                        if (typeof logger === "undefined" || logger === null) {
                                            // Đọc thông tin từ Local Storage
                                            const loggedUserJson = localStorage.getItem("users");
                                            const loggedUser = JSON.parse(loggedUserJson) || [];
                                            const cardList = document.getElementById('card-list');
                                            for (let i = 0; i < loggedUser.length; i++) {
                                                const user = loggedUser[i];
                                                const chapterId = user.chapterId;
                                                const mangaId = user.mangaId;

                                                fetch('http://localhost:8080/mangaTest/getManga/' + mangaId,{
                                                    method: 'GET'
                                                })
                                                    .then(res => {
                                                        if (!res.ok){
                                                            throw new Error('Network response was not ok');
                                                        }
                                                        return res.json();
                                                    })
                                                    .then(data => {

                                                        // Tạo thẻ card mới
                                                        const cardContainer = document.createElement('div');
                                                        cardContainer.setAttribute('class', 'card-container w-full flex gap-[10px] h-[90px]');
                                                        const cardImage = document.createElement('div');
                                                        cardImage.setAttribute('class', 'card-image w-[90px] h-full');
                                                        const img = document.createElement('img');
                                                        img.setAttribute('src', data.featuredImage);
                                                        img.setAttribute('class','w-full h-full');
                                                        cardImage.appendChild(img);
                                                        const cardText = document.createElement('div');
                                                        cardText.setAttribute('class', 'card-text ml-1');
                                                        const cardTitle = document.createElement('h2');
                                                        cardTitle.setAttribute('class', 'card-title text-sm m-0 w-[140px]');
                                                        cardTitle.innerHTML = data.title;

                                                        /*
                                                        const MAX_LENGTH = 14; // Tối đa chiều cao của thẻ card-title
                                                        if (data.title.length > MAX_LENGTH) {
                                                            // Nếu tiêu đề vượt quá giới hạn, cắt giảm chiều dài và thêm dấu ba chấm
                                                            cardTitle.innerHTML = data.title.slice(0, MAX_LENGTH) + '...';
                                                        } else {
                                                            cardTitle.innerHTML = data.title;
                                                        }
                                                        */
                                                        const cardLink  = document.createElement('a');
                                                        console.log(data.title + ' title ')
                                                        cardLink.setAttribute('class', 'card-link text-blue-500 hover:underline');
                                                        cardLink.setAttribute('href', 'http://localhost:8080/manga/' + data.title + '/chapter/' + chapterId);
                                                        cardLink.innerHTML = 'Đọc tiếp';

                                                        cardText.appendChild(cardTitle);
                                                        cardText.appendChild(cardLink);
                                                        cardContainer.appendChild(cardImage);
                                                        cardContainer.appendChild(cardText);
                                                        cardList.appendChild(cardContainer);
                                                    })
                                                    .catch(error => {
                                                        console.error('Error:', error);
                                                    });
                                            }
                                        }
                                    })
                                    /*]]>*/

                            </script>
                            <!--Kết thúc sự kiện đọc lịch sử từ localstorage-->
                        </div>
                        <div class="list-genre min-w-[200px] h-fit border p-[10px] mt-[15px] rounded">
                            <h3 class="border w-fit text-sm text-white font-medium rounded bg-[#eb3349] py-[5px] px-[10px]">
                                Thể loại</h3>

                            <ul class="grid grid-cols-2 gap-2 space-x-2 mt-[20px]">
                                <li class="flex items-center space-x-2" th:each="item : ${genreList}">
                                    <i class="fas fa-caret-right" style="color: #343537;"></i>
                                    <a class="cursor-pointer hover:text-[#eb3349]"
                                       th:href="@{'/manga-gener/' + ${item.name} + '/' + ${item.id}}"
                                       th:text="${item.name}"></a>
                                </li>
                            </ul>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
</html>